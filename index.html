<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Looper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            background-color: #f9f9f9;
            color: #0f0f0f;
        }

        /* Top Banner Ad */
        .top-banner {
            width: 100%;
            height: 90px;
            background-color: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
            border-bottom: 1px solid #ccc;
        }

        /* Main Container */
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            gap: 20px;
        }

        /* Side Ads */
        .side-ad {
            width: 160px;
            background-color: #e0e0e0;
            min-height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
            flex-shrink: 0;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            max-width: 900px;
            margin: 0 auto;
        }

        /* Search Bar Container */
        .search-container {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            align-items: center;
        }

        .search-box {
            flex: 1;
            display: flex;
            align-items: center;
            background-color: #ffffff;
            border: 1px solid #ccc;
            border-radius: 40px;
            padding: 0 20px;
            height: 46px;
            transition: border-color 0.2s;
        }

        .search-box:focus-within {
            border-color: #065fd4;
        }

        .youtube-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .search-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 16px;
            background: transparent;
        }

        .search-input::placeholder {
            color: #aaa;
        }

        .search-button {
            width: 46px;
            height: 46px;
            background-color: #065fd4;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            flex-shrink: 0;
        }

        .search-button:hover {
            background-color: #0456be;
        }

        .search-button svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        /* URL Display */
        .url-display {
            margin-bottom: 20px;
            font-size: 14px;
            color: #0f0f0f;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .url-text {
            flex: 1;
            color: #065fd4;
            word-break: break-all;
        }

        .copy-button {
            padding: 8px 16px;
            background-color: #065fd4;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background-color 0.2s;
            white-space: nowrap;
        }

        .copy-button:hover {
            background-color: #0456be;
        }

        .copy-button.copied {
            background-color: #0f9d58;
        }

        /* Video Container */
        .video-container {
            width: 100%;
            aspect-ratio: 16 / 9;
            background-color: #d9d9d9;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 18px;
            position: relative;
            overflow: hidden;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
        }

        /* Time Selection Controls */
        .time-controls {
            margin-top: 24px;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .time-controls h3 {
            font-size: 16px;
            margin-bottom: 16px;
            color: #0f0f0f;
        }

        .time-inputs {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 16px;
        }

        .time-input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .time-input-group label {
            font-size: 14px;
            color: #606060;
        }

        .time-input-group input {
            width: 80px;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        .apply-button {
            padding: 10px 24px;
            background-color: #065fd4;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .apply-button:hover {
            background-color: #0456be;
        }

        .error-message {
            color: #cc0000;
            font-size: 14px;
            margin-top: 8px;
        }

        @media (max-width: 1200px) {
            .side-ad {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .top-banner {
                height: 50px;
                font-size: 12px;
            }

            .container {
                padding: 20px 10px;
            }

            .search-container {
                flex-direction: column;
            }

            .time-inputs {
                flex-direction: column;
                align-items: flex-start;
            }

            .url-display {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Top Banner Ad -->
    <div class="top-banner">Advertisement Banner</div>

    <!-- Main Container -->
    <div class="container">
        <!-- Left Side Ad -->
        <div class="side-ad">Ad Space</div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-box">
                    <svg class="youtube-icon" viewBox="0 0 24 24">
                        <path fill="#FF0000" d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                    <input type="text" class="search-input" id="urlInput" placeholder="Paste video URL here">
                </div>
                <button class="search-button" id="searchButton">
                    <svg viewBox="0 0 24 24">
                        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </button>
            </div>

            <!-- URL Display -->
            <div class="url-display">
                <div style="display: flex; align-items: center; gap: 4px;">
                    Looped URL: <span class="url-text" id="loopedUrl"></span>
                </div>
                <button class="copy-button" id="copyButton" style="display: none;">Copy Link</button>
            </div>

            <!-- Video Container -->
            <div class="video-container" id="videoContainer">
                Video Player
            </div>

            <!-- Time Selection Controls -->
            <div class="time-controls" id="timeControls">
                <h3>Select Loop Range</h3>
                <div class="time-inputs">
                    <div class="time-input-group">
                        <label>Start (seconds):</label>
                        <input type="number" id="startTime" min="0" value="0" step="1">
                    </div>
                    <div class="time-input-group">
                        <label>End (seconds):</label>
                        <input type="number" id="endTime" min="0" value="30" step="1">
                    </div>
                    <button class="apply-button" id="applyButton">Apply Loop</button>
                </div>
                <div class="error-message" id="errorMessage"></div>
            </div>
        </div>

        <!-- Right Side Ad -->
        <div class="side-ad">Ad Space</div>
    </div>

    <script>
        let videoId = '';
        let player = null;
        let loopCheckInterval = null;
        let playerReady = false;
        let isApiReady = false;

        const urlInput = document.getElementById('urlInput');
        const searchButton = document.getElementById('searchButton');
        const videoContainer = document.getElementById('videoContainer');
        const loopedUrlSpan = document.getElementById('loopedUrl');
        const copyButton = document.getElementById('copyButton');
        const startTimeInput = document.getElementById('startTime');
        const endTimeInput = document.getElementById('endTime');
        const applyButton = document.getElementById('applyButton');
        const errorMessage = document.getElementById('errorMessage');

        // Charger l'API YouTube
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function extractVideoId(url) {
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/
            ];
            for (let pattern of patterns) {
                const match = url.match(pattern);
                if (match && match[1]) return match[1];
            }
            return null;
        }

        function updateSearchButtonIcon(status) {
            const svg = searchButton.querySelector('svg');
            if (status === 'error') {
                svg.innerHTML = '<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>';
                setTimeout(() => updateSearchButtonIcon('default'), 2000);
            } else if (status === 'success') {
                svg.innerHTML = '<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>';
                setTimeout(() => updateSearchButtonIcon('default'), 2000);
            } else {
                svg.innerHTML = '<path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>';
            }
        }

        function onYouTubeIframeAPIReady() {
            isApiReady = true;
            const urlParams = new URLSearchParams(window.location.search);
            const v = urlParams.get('v');
            if (v) {
                videoId = v;
                urlInput.value = `https://www.youtube.com/watch?v=${v}`;
                startTimeInput.value = urlParams.get('start') || 0;
                endTimeInput.value = urlParams.get('end') || 30;
                loadVideo(true); 
            }
        }

        function loadVideo(autoFullscreen = false) {
            if (!isApiReady) return;
            const url = urlInput.value.trim();
            const id = extractVideoId(url);

            if (id) videoId = id;
            if (!videoId) {
                updateSearchButtonIcon('error');
                return;
            }

            updateSearchButtonIcon('success');
            if (player) { try { player.destroy(); } catch(e) {} }

            videoContainer.innerHTML = '<div id="ytPlayer"></div>';
            player = new YT.Player('ytPlayer', {
                height: '100%', width: '100%', videoId: videoId,
                playerVars: { 
                    'autoplay': 1, 
                    'start': parseInt(startTimeInput.value), 
                    'rel': 0, 
                    'modestbranding': 1,
                    'origin': window.location.origin 
                },
                events: {
                    'onReady': (e) => {
                        playerReady = true;
                        startLoopCheck();
                        // Le plein écran nécessite souvent un clic utilisateur.
                        // Sur GitHub, au chargement d'un lien partagé, il se lancera
                        // dès que l'utilisateur interagira avec la page.
                        if (autoFullscreen) toggleFullScreen();
                    },
                    'onStateChange': (e) => {
                        if (e.data === YT.PlayerState.ENDED) {
                            player.seekTo(parseInt(startTimeInput.value) || 0);
                            player.playVideo();
                        }
                    }
                }
            });
            updateSiteUrl();
        }

        function toggleFullScreen() {
            const el = videoContainer;
            const requestMethod = el.requestFullScreen || el.webkitRequestFullScreen || el.mozRequestFullScreen || el.msRequestFullScreen;
            if (requestMethod) requestMethod.call(el).catch(err => console.log("Plein écran bloqué par le navigateur (cliquez sur la page pour autoriser)"));
        }

        function startLoopCheck() {
            if (loopCheckInterval) clearInterval(loopCheckInterval);
            loopCheckInterval = setInterval(() => {
                if (player && playerReady && player.getCurrentTime) {
                    const now = player.getCurrentTime();
                    const end = parseInt(endTimeInput.value) || 30;
                    if (now >= end) player.seekTo(parseInt(startTimeInput.value) || 0);
                }
            }, 200);
        }

        function updateSiteUrl() {
            if (videoId) {
                const siteUrl = window.location.origin + window.location.pathname;
                const params = `?v=${videoId}&start=${startTimeInput.value}&end=${endTimeInput.value}`;
                loopedUrlSpan.textContent = siteUrl + params;
                copyButton.style.display = 'block';
            }
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(loopedUrlSpan.textContent).then(() => {
                const oldText = copyButton.textContent;
                copyButton.textContent = '✓ Copied!';
                copyButton.classList.add('copied');
                setTimeout(() => {
                    copyButton.textContent = oldText;
                    copyButton.classList.remove('copied');
                }, 2000);
            });
        }

        searchButton.addEventListener('click', () => loadVideo(false));
        applyButton.addEventListener('click', () => loadVideo(false));
        copyButton.addEventListener('click', copyToClipboard);
        urlInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') loadVideo(false); });
    </script>
</body>

</html>
